
<style type="text/css">
	.rounded-box {
		-webkit-border-radius: 10px;
		     -moz-border-radius: 10px;
		          border-radius: 10px;
	}
	.capture-ui{
		background-color: #cccccc;
	}
	.capture-container {
		margin: 6px 6px 3px 6px;
		background-color: #FFFFFF;
		display: inline-block;
		padding: 5px 5px 5px 5px;
	}
	.capture-info {
		margin: 3px 6px 6px 6px;
		background-color: #FFFFFF;
		padding: 5px 5px 5px 5px;
	}
	.source-info {
		margin: 3px 6px 6px 6px;
		background-color: #FFFFFF;
		padding: 5px 5px 5px 5px;
	}
	.metadata-info {
		margin: 3px 6px 6px 6px;
		background-color: #FFFFFF;
		padding: 5px 5px 5px 5px;
	}
</style>

<script type="text/javascript" src="/javascripts/fixupPath.js"></script>


<script type="text/javascript">
	//wiring
	var parent_url = decodeURIComponent(document.location.hash.replace(/^#/, ''));

	if (!!window.addEventListener)
		window.addEventListener('message', receiver, false);
	else
		window.attachEvent('onmessage', receiver);
		
	function receiver(e)
	{
		if (e.origin == parent_url)
		{
			var htmlSummary = $('#uberText');
			var snippetContent = $('#snippet_content');
			snippetContent.val(e.data);
			htmlSummary.html(e.data);
			
			try {
		    	htmlSummary.fixupAllPaths(function(container){
					var sourceUrl = '<%=h @url %>';
					return sourceUrl;
				});
		    }
		    catch(err) {
		    	alert(err);
		    }

		    //note: htmlSummary.fixupAllPaths appears to be not wellformed in youtube
		    var text = htmlSummary.html();
		    //alert(html);
			snippetContent.val(text);

		}
	}
</script>



<form id="snippet" action="/snippets" method="post">
	<div class="capture-ui rounded-box">
		<div class="capture-container rounded-box">
			<h2>Here is your text:</h2>
			<p id="uberText"><%= @text %></p>
			<input id="snippet_content" name="snippet[content]" type="hidden" />
		</div>
		<table>
			<tr>
				<td style="vertical-align:top;">
					<div class="capture-info rounded-box">
						<h2>Describe This Information:</h2>
						<textarea name="description" wrap="physical" style="width: 300px; margin-right: 6px; height: 222px"></textarea>
					</div>
				</td>
				<td style="vertical-align:top;">
					<div class = "source-info rounded-box">
						<h2>Source Information</h2>
						<h4>Url: <%=h @url %></h4>
						 <input id="snippet_source_url" name="snippet[source_url]" type="hidden" value="<%=h @url %>" />
					</div>
					<div class = "metadata-info rounded-box">
						<h2>Add tags:</h2>
						<textarea name="tags" wrap="physical" style="width: 300px; margin-right: 6px; height: 100px"></textarea>
					</div>
				</td>
				<td style="vertical-align:top;">
				  <div class="actions">
				    <input name="commit" type="submit" value="Create Snippet" />
				  </div>
				</td>
			</tr>
		</table>
		<div style="clear: both"></div>
	</div>
</form>	
